$(function(){
    $('.autonumeric').each(function(i,e){
        new AutoNumeric(e,{
            decimalPlaces:0,
            currencySymbol:'',
            decimalCharacter:',',
            unformatOnSubmit:true,
            digitGroupSeparator:'.'
        });
    });
    if($('.table-data').length>0){
        $('.table-data').DataTable({
            ordering:false,
            pagingType:'full_numbers'
        });
    }
    $('.form-ajax').each(function(){
        let form=$(this);
        form.bind('submit',function(e){
            e.preventDefault();
            $.ajax({
                url:form.attr('action'),
                data:$(this).serialize(),
                method:'post',
                error:function(){
                    Swal.fire({
                        icon:'error',
                        text:'Silahkan coba lagi.',
                        title:'Server sibuk'
                    }).then(()=>{
                        window.location.reload(true);
                    });
                },
                success:function(response){
                    if(response.error){
                        Swal.fire({
                            icon:'warning',
                            html:response.message
                        });
                    }else{
                        let message='Data Tersimpan';
                        if(response.message){
                            message=response.message;
                        }
                        Swal.fire({
                            icon:'success',
                            timer:1500,
                            title:message,
                            timerProgressBar:true,
                            showConfirmButton:false,
                            willClose:()=>{
                                window.location=response.url;
                            }
                        });
                    }
                }
            });
        });
    });
    $('.form-file').each(function(){
        let form=$(this);
        form.bind('submit',function(e){
            e.preventDefault();
            $.ajax({
                url:form.attr('action'),
                data:new FormData(this),
                cache:false,
                method:'post',
                dataType:'json',
                contentType:false,
                processData:false
            }).done(function(response){
                if(response!==''){
                    if(!response.error){
                        let message='Data Tersimpan';
                        if(response.message){
                            message=response.message;
                        }
                        Swal.fire({
                            icon:'success',
                            timer:1500,
                            title:message,
                            timerProgressBar:true,
                            showConfirmButton:false,
                            willClose:()=>{
                                window.location=response.url;
                            }
                        });
                    }else{
                        Swal.fire({
                            icon:'warning',
                            html:response.message
                        });
                    }
                }else{
                    Swal.fire({
                        icon:'warning',
                        text:'Silahkan coba lagi.'
                    });
                }
            }).fail(function(){
                Swal.fire({
                    icon:'error',
                    text:'Silahkan coba lagi.',
                    title:'Server sibuk'
                }).then(()=>{
                    window.location.reload(true);
                });
            });
        });
    });
    $(document).on('click','.btn-delete',function(){
        let btn=$(this);
        Swal.fire({
            icon:'question',
            text:'Data yang terhapus tidak dapat dikembalikan!',
            title:'Apakah Anda yakin?',
            reverseButtons:true,
            showCancelButton:true,
            cancelButtonText:'Batal',
            cancelButtonColor:'#3085d6',
            confirmButtonText:'Ya, hapus!',
            confirmButtonColor:'#d33'
        }).then((result)=>{
            if(result.isConfirmed){
                $.ajax({
                    url:btn.data('url'),
                    data:{id:btn.data('id'),act:btn.data('act')},
                    method:'post',
                    dataType:'json'
                }).done(function(response){
                    Swal.fire({
                        icon:'success',
                        timer:1500,
                        title:'Data Terhapus',
                        timerProgressBar:true,
                        showConfirmButton:false,
                        willClose:()=>{
                            window.location=response.url;
                        }
                    });
                });
            }
        });
    });
});